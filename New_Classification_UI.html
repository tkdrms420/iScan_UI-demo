<!DOCTYPE html>
<!-- saved from url=(0090)file:///C:/Users/YOUN/Desktop/%EC%8B%A0%EA%B7%9C_%EC%8B%AC%ED%99%94%EB%B6%84%EB%A5%98.html -->
<html lang="ko"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>신규 심화분류 - Zulu JRE 라이선스 비교</title>

  <style>
    :root{
      --bg:#0b1020;
      --panel: rgba(255,255,255,.03);
      --panel2: rgba(255,255,255,.02);
      --border: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.88);
      --muted: rgba(255,255,255,.58);
      --accent:#2d6bff;

      --rowHover: rgba(45,107,255,.08);
      --rowSelected: rgba(45,107,255,.16);

      --goodBg: rgba(53,208,127,.16);
      --goodBd: rgba(53,208,127,.45);
      --goodTx: rgba(168,255,212,.95);

      --badBg: rgba(255,77,79,.16);
      --badBd: rgba(255,77,79,.45);
      --badTx: rgba(255,195,195,.95);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", Arial;
      background:
        radial-gradient(1200px 700px at 20% 0%, rgba(45,107,255,.14), transparent 55%),
        radial-gradient(900px 600px at 80% 30%, rgba(53,208,127,.10), transparent 50%),
        var(--bg);
      color: var(--text);
    }

    .top{
      padding:18px 18px 12px 18px;
      border-bottom:1px solid var(--border);
      background: rgba(11,16,32,.55);
      backdrop-filter: blur(10px);
    }
    .titleRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    h1{
      margin:0;
      font-size:18px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .desc{
      margin:8px 0 0 0;
      color: var(--muted);
      font-size:12px;
      line-height:1.45;
    }
    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .btn{
      border-radius:8px;
      padding:9px 12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.88);
      font-weight:900;
      font-size:13px;
      cursor:pointer;
    }
    .btn.primary{
      background: rgba(45,107,255,.22);
      border-color: rgba(45,107,255,.55);
    }

    .wrap{
      padding:14px 18px 22px 18px;
    }
    .card{
      border:1px solid var(--border);
      border-radius:12px;
      overflow:hidden;
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
    }

    .toolbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 14px;
      border-bottom:1px solid var(--border);
      background: rgba(0,0,0,.12);
    }
    .count{
      color: var(--muted);
      font-size:12px;
      font-weight:900;
    }
    .legend{
      display:flex;
      align-items:center;
      gap:8px;
      color: var(--muted);
      font-size:12px;
      font-weight:900;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      font-size:12px;
      font-weight:900;
      letter-spacing:.1px;
      white-space:nowrap;
    }
    .badge.match{
      background: var(--goodBg);
      border-color: var(--goodBd);
      color: var(--goodTx);
    }
    .badge.mismatch{
      background: var(--badBg);
      border-color: var(--badBd);
      color: var(--badTx);
    }

    /* === 테이블/컬럼 리사이즈 핵심 === */
    .tableWrap{
      overflow:auto;           /* 컬럼 늘리면 가로 스크롤 자연스럽게 */
      max-height: 70vh;
    }

    table{
      width:100%;
      border-collapse: collapse;
      table-layout: fixed;     /* colgroup width 적용 + ellipsis 안정 */
      min-width: 1180px;       /* 필요 시 조정 */
      font-size:13px;
    }

    thead th{
      position: sticky;        /* 스크롤 시 헤더 고정 */
      top: 0;
      z-index: 2;
      background: rgba(15,23,48,.95);
      color: rgba(255,255,255,.78);
      text-align:left;
      padding:12px 10px;
      border-bottom:1px solid var(--border);
      font-weight:900;
      white-space:nowrap;

      padding-right: 18px;     /* 리사이즈 핸들 영역 */
    }

    tbody td{
      padding:12px 10px;
      border-bottom:1px solid rgba(255,255,255,.06);
      color: rgba(255,255,255,.86);
      vertical-align:middle;
      overflow:hidden;
    }

    tbody tr:hover{ background: var(--rowHover); }
    tbody tr.selected{ background: var(--rowSelected); }

    .cell-muted{ color: rgba(255,255,255,.68); font-weight:800; }
    .right{ text-align:right; }
    .pct{ color: rgba(53,208,127,.95); font-weight:900; }

    .checkCell{ width:44px; }
    input[type="checkbox"]{
      width:16px;
      height:16px;
      accent-color: var(--accent);
      cursor:pointer;
    }

    /* 셀 텍스트 ... + hover title */
    .cellText{
      display:block;
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;

      border-radius:6px;
      padding:4px 6px;
      margin:-4px -6px;
      cursor:text;
      outline:none;
    }
    .cellText:focus{
      background: rgba(255,255,255,.06);
      box-shadow: 0 0 0 2px rgba(45,107,255,.25);
    }
    /* 편집 중에는 ... 해제 */
    .cellText.editing{
      white-space: normal;
      overflow: visible;
      text-overflow: clip;
      position: relative;
      z-index: 5;
    }

    .hint{
      padding:12px 14px;
      color: var(--muted);
      font-size:12px;
      line-height:1.5;
      border-top:1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.10);
    }

    /* 리사이즈 핸들 */
    th .col-resizer{
      position:absolute;
      top:0;
      right:-4px;
      width:10px;          /* 잡기 쉽게 */
      height:100%;
      cursor: col-resize;
      user-select:none;
      background: transparent;
    }
    body.resizing{
      cursor: col-resize;
      user-select: none;
    }
  </style>
</head>

<body class="">
  <div class="top">
    <div class="titleRow">
      <div>
        <h1>신규 심화분류</h1>
        <p class="desc">
          체크한 항목들끼리만 <b>일치 여부</b>를 비교합니다. (선택 0~1개면 표시 없음)<br>
          
        </p>
      </div>
      <div class="actions">
        <button class="btn" id="btnClear">선택해제</button>
        <button class="btn primary" id="btnSave">작업저장</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="toolbar">
        <div class="count"><span id="selectedCount">0</span>개 선택됨</div>
		<button class="btn primary" id="btnSave">CSV저장</button>
      </div>

      <div class="tableWrap">
        <table id="tbl" aria-label="제품 목록">
          <!-- colgroup: 여기 width가 바뀌면 헤더/내용이 같이 반응 -->
          <colgroup id="colgroup">
            <col style="width:44px">
            <col style="width:90px">
            <col style="width:130px">
            <col style="width: 70px;">
            <col style="width: 239.406px;">
            <col style="width: 119.969px;">
            <col style="width: 129.953px;">
            <col style="width: 484.812px;">
            <col style="width:95px">
            <col style="width:110px">
            <col style="width:220px">
            <col style="width:140px">
          </colgroup>

          <thead>
            <tr>
              <th class="checkCell">
                <input type="checkbox" id="checkAll" aria-label="전체 선택">
              </th>
              <th>고객사 <span class="col-resizer" data-col="1"></span></th>
              <th>주요저작권사 <span class="col-resizer" data-col="2"></span></th>
              <th>패턴 <span class="col-resizer" data-col="3"></span></th>
              <th>제어판명 <span class="col-resizer" data-col="4"></span></th>
              <th>저작권사명 <span class="col-resizer" data-col="5"></span></th>
              <th>AI선별 제품명 <span class="col-resizer" data-col="6"></span></th>
              <th>분석 근거 <span class="col-resizer" data-col="7"></span></th>
              <th class="right">정확도 <span class="col-resizer" data-col="8"></span></th>
              <th>분석유형 <span class="col-resizer" data-col="9"></span></th>
              <th>AI종합평가 <span class="col-resizer" data-col="10"></span></th>
              <th>일치 여부 <span class="col-resizer" data-col="11"></span></th>
            </tr>
          </thead>

          <tbody id="tbody">
        <tr data-row="35" class="">
          <td class="checkCell">
            <input type="checkbox" data-check="35" aria-label="행 선택">
          </td>
          <td>
        <div class="cellText " data-edit="1" data-field="customer" data-id="35" contenteditable="false" title="35">
          35
        </div>
      </td>
          <td class="cell-muted">
        <div class="cellText cell-muted" data-edit="1" data-field="majorCopyright" data-id="35" contenteditable="false" title="Y">
          Y
        </div>
      </td>
          <td class="cell-muted">
        <div class="cellText cell-muted" data-edit="1" data-field="pattern" data-id="35" contenteditable="false" title="0">
          0
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="controlPanel" data-id="35" contenteditable="false" title="Zulu JRE 8.52.0.23 (8u282), 64-bit">
          Zulu JRE 8.52.0.23 (8u282), 64-bit
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="copyrightName" data-id="35" contenteditable="false" title="Azul Systems">
          Azul Systems
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="aiProduct" data-id="35" contenteditable="false" title="Zulu JRE 17">
          Zulu JRE 17
        </div>
      </td>
          <td>
        <div class="cellText" data-edit="1" data-field="evidence" data-id="35" contenteditable="false" title="Azul Zulu JRE 17: 동일한 base_name을 가지고 있으며, 저작권사가 동일하지만 major_version이 17로, 버전 업그레이드 후보로 적합함"><span data-teams="true">Azul Zulu JRE 17: 동일한 base_name을 가지고 있으며, 저작권사가 동일하지만 major_version이 17로, 버전 업그레이드 후보로 적합함</span></div>
      </td>
          <td class="right pct">
        <div class="cellText pct" data-edit="1" data-field="accuracy" data-id="35" contenteditable="false" title="100.00%">
          100.00%
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="type" data-id="35" contenteditable="false" title="버전업">
          버전업
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="aiEval" data-id="35" contenteditable="false" title="저작권사 매칭 (1.00), 에디션 매칭 (1.00) (종합점수: 0.64)">
          저작권사 매칭 (1.00), 에디션 매칭 (1.00) (종합점수: 0.64)
        </div>
      </td>
          <td data-license-cell="35"></td>
        </tr>
      
        <tr data-row="14" class="">
          <td class="checkCell">
            <input type="checkbox" data-check="14" aria-label="행 선택">
          </td>
          <td>
        <div class="cellText " data-edit="1" data-field="customer" data-id="14" contenteditable="false" title="14">
          14
        </div>
      </td>
          <td class="cell-muted">
        <div class="cellText cell-muted" data-edit="1" data-field="majorCopyright" data-id="14" contenteditable="false" title="Y">
          Y
        </div>
      </td>
          <td class="cell-muted">
        <div class="cellText cell-muted" data-edit="1" data-field="pattern" data-id="14" contenteditable="false" title="0">
          0
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="controlPanel" data-id="14" contenteditable="false" title="Zulu JRE 11.42.0.13 (8u282), 64-bit">
          Zulu JRE 11.42.0.13 (8u282), 64-bit
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="copyrightName" data-id="14" contenteditable="false" title="Azul Systems">
          Azul Systems
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="aiProduct" data-id="14" contenteditable="false" title="Zulu JRE 17">
          Zulu JRE 17
        </div>
      </td>
          <td>
        <div class="cellText" data-edit="1" data-field="evidence" data-id="14" contenteditable="false" title="Azul Zulu JRE 17: 동일한 base_name을 가지고 있으며, 저작권사가 동일하지만 major_version이 17로, 버전 업그레이드 후보로 적합함"><span data-teams="true">Azul Zulu JRE 17: 동일한 base_name을 가지고 있으며, 저작권사가 동일하지만 major_version이 17로, 버전 업그레이드 후보로 적합함</span></div>
      </td>
          <td class="right pct">
        <div class="cellText pct" data-edit="1" data-field="accuracy" data-id="14" contenteditable="false" title="97.88%">
          97.88%
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="type" data-id="14" contenteditable="false" title="버전업">
          버전업
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="aiEval" data-id="14" contenteditable="false" title="저작권사 매칭 (1.00), 에디션 매칭 (1.00) (종합점수: 0.64)">
          저작권사 매칭 (1.00), 에디션 매칭 (1.00) (종합점수: 0.64)
        </div>
      </td>
          <td data-license-cell="14"></td>
        </tr>
      
        <tr data-row="26" class="">
          <td class="checkCell">
            <input type="checkbox" data-check="26" aria-label="행 선택">
          </td>
          <td>
        <div class="cellText " data-edit="1" data-field="customer" data-id="26" contenteditable="false" title="26">
          26
        </div>
      </td>
          <td class="cell-muted">
        <div class="cellText cell-muted" data-edit="1" data-field="majorCopyright" data-id="26" contenteditable="false" title="Y">
          Y
        </div>
      </td>
          <td class="cell-muted">
        <div class="cellText cell-muted" data-edit="1" data-field="pattern" data-id="26" contenteditable="false" title="0">
          0
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="controlPanel" data-id="26" contenteditable="false" title="Zulu JRE 8.44.0.23 (7u282), 64-bit">
          Zulu JRE 8.44.0.23 (7u282), 64-bit
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="copyrightName" data-id="26" contenteditable="false" title="Azul Systems">
          Azul Systems
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="aiProduct" data-id="26" contenteditable="false" title="Zulu JRE 17">
          Zulu JRE 17
        </div>
      </td>
          <td>
        <div class="cellText" data-edit="1" data-field="evidence" data-id="26" contenteditable="false" title="Azul Zulu JRE 17: 동일한 base_name을 가지고 있으며, 저작권사가 동일하지만 major_version이 17로, 버전 업그레이드 후보로 적합함"><span data-teams="true">Azul Zulu JRE 17: 동일한 base_name을 가지고 있으며, 저작권사가 동일하지만 major_version이 17로, 버전 업그레이드 후보로 적합함</span></div>
      </td>
          <td class="right pct">
        <div class="cellText pct" data-edit="1" data-field="accuracy" data-id="26" contenteditable="false" title="98.75%">
          98.75%
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="type" data-id="26" contenteditable="false" title="버전업">
          버전업
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="aiEval" data-id="26" contenteditable="false" title="저작권사 매칭 (1.00), 에디션 매칭 (1.00) (종합점수: 0.64)">
          저작권사 매칭 (1.00), 에디션 매칭 (1.00) (종합점수: 0.64)
        </div>
      </td>
          <td data-license-cell="26"></td>
        </tr>
      
        <tr data-row="16" class="">
          <td class="checkCell">
            <input type="checkbox" data-check="16" aria-label="행 선택">
          </td>
          <td>
        <div class="cellText " data-edit="1" data-field="customer" data-id="16" contenteditable="false" title="16">
          16
        </div>
      </td>
          <td class="cell-muted">
        <div class="cellText cell-muted" data-edit="1" data-field="majorCopyright" data-id="16" contenteditable="false" title="Y">
          Y
        </div>
      </td>
          <td class="cell-muted">
        <div class="cellText cell-muted" data-edit="1" data-field="pattern" data-id="16" contenteditable="false" title="0">
          0
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="controlPanel" data-id="16" contenteditable="false" title="Zulu JRE 8.22.0.53 (8u280), 32-bit">
          Zulu JRE 8.22.0.53 (8u280), 32-bit
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="copyrightName" data-id="16" contenteditable="false" title="Azul Systems">
          Azul Systems
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="aiProduct" data-id="16" contenteditable="false" title="Zulu JRE 17">
          Zulu JRE 17
        </div>
      </td>
          <td>
        <div class="cellText" data-edit="1" data-field="evidence" data-id="16" contenteditable="false" title="Azul Zulu JRE 17: 동일한 base_name을 가지고 있으며, 저작권사가 동일하지만 major_version이 17로, 버전 업그레이드 후보로 적합함"><span data-teams="true">Azul Zulu JRE 17: 동일한 base_name을 가지고 있으며, 저작권사가 동일하지만 major_version이 17로, 버전 업그레이드 후보로 적합함</span></div>
      </td>
          <td class="right pct">
        <div class="cellText pct" data-edit="1" data-field="accuracy" data-id="16" contenteditable="false" title="96.97%">
          96.97%
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="type" data-id="16" contenteditable="false" title="버전업">
          버전업
        </div>
      </td>
          <td>
        <div class="cellText " data-edit="1" data-field="aiEval" data-id="16" contenteditable="false" title="저작권사 매칭 (1.00), 에디션 매칭 (1.00) (종합점수: 0.64)">
          저작권사 매칭 (1.00), 에디션 매칭 (1.00) (종합점수: 0.64)
        </div>
      </td>
          <td data-license-cell="16"></td>
        </tr>
      </tbody>
        </table>
      </div>

      <div class="hint">
        - AI선별 제품명: 수집DB와 비교 시 AI가 참조한 MDB 제품명<br>
        - 분석 근거: 수집 데이터와 MDB 제품 간의 분석 결과 설명<br>
        - AI종합평가: 매칭 결과를 점수로 환산한 값<br>
		- 일치 여부: 선택 항목의 라이선스 분류 일치 여부
      </div>
    </div>
  </div>

  <script>
    // ====== 데모 데이터 (질문에서 언급한 4개 Zulu JRE) ======
    const rows = [
      {
        id: 35,
        customer: "35",
        majorCopyright: "Y",
        pattern: "0",
        controlPanel: "Zulu JRE 8.52.0.23 (8u282), 64-bit",
        copyrightName: "Azul Systems",
        aiProduct: "Zulu JRE 17",
        evidence: "Azul Zulu JRE 17: 동일한 base_name을 가지고 있으며, 저작권사가 동일하지만 major_version이 17로, 버전 업그레이드 후보로 적합함",
        accuracy: "100.00%",
        type: "버전업",
        aiEval: "저작권사 매칭 (1.00), 에디션 매칭 (1.00) (종합점수: 0.64)",
        checked: false,
      },
      {
        id: 14,
        customer: "14",
        majorCopyright: "Y",
        pattern: "0",
        controlPanel: "Zulu JRE 11.42.0.13 (8u282), 64-bit",
        copyrightName: "Azul Systems",
        aiProduct: "Zulu JRE 17",
        evidence: "Azul Zulu JRE 17: 동일한 base_name을 가지고 있으며, 저작권사가 동일하지만 major_version이 17로, 버전 업그레이드 후보로 적합함",
        accuracy: "97.88%",
        type: "버전업",
        aiEval: "저작권사 매칭 (1.00), 에디션 매칭 (1.00) (종합점수: 0.64)",
        checked: false,
      },
      {
        id: 26,
        customer: "26",
        majorCopyright: "Y",
        pattern: "0",
        controlPanel: "Zulu JRE 8.44.0.23 (7u282), 64-bit",
        copyrightName: "Azul Systems",
        aiProduct: "Zulu JRE 17",
        evidence: "Azul Zulu JRE 17: 동일한 base_name을 가지고 있으며, 저작권사가 동일하지만 major_version이 17로, 버전 업그레이드 후보로 적합함",
        accuracy: "98.75%",
        type: "버전업",
        aiEval: "저작권사 매칭 (1.00), 에디션 매칭 (1.00) (종합점수: 0.64)",
        checked: false,
      },
      {
        id: 16,
        customer: "16",
        majorCopyright: "Y",
        pattern: "0",
        controlPanel: "Zulu JRE 8.22.0.53 (8u280), 32-bit",
        copyrightName: "Azul Systems",
        aiProduct: "Zulu JRE 17",
        evidence: "Azul Zulu JRE 17: 동일한 base_name을 가지고 있으며, 저작권사가 동일하지만 major_version이 17로, 버전 업그레이드 후보로 적합함",
        accuracy: "96.97%",
        type: "버전업",
        aiEval: "저작권사 매칭 (1.00), 에디션 매칭 (1.00) (종합점수: 0.64)",
        checked: false,
      },
    ];

    // ====== 라이선스 그룹 규칙(데모): 8.*는 같은 그룹, 11.*는 다른 그룹 ======
    function deriveLicenseGroup(controlPanelText){
      const t = (controlPanelText || "").trim();
      if (/^Zulu JRE\s*11\b/i.test(t)) return "GROUP_B_JRE11";
      if (/^Zulu JRE\s*8\b/i.test(t)) return "GROUP_A_JRE8";
      return "GROUP_OTHER";
    }

    // ====== 렌더링/상태 ======
    const tbody = document.getElementById("tbody");
    const selectedCountEl = document.getElementById("selectedCount");
    const checkAll = document.getElementById("checkAll");

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function cellEditable(text, field, rowId, extraClass=""){
      const safe = escapeHtml(text);
      const title = escapeHtml(text);
      return `
        <div class="cellText ${extraClass}"
             data-edit="1"
             data-field="${field}"
             data-id="${rowId}"
             contenteditable="false"
             title="${title}">
          ${safe}
        </div>
      `;
    }

    function render(){
      tbody.innerHTML = rows.map(r => `
        <tr data-row="${r.id}" class="${r.checked ? "selected" : ""}">
          <td class="checkCell">
            <input type="checkbox" data-check="${r.id}" ${r.checked ? "checked" : ""} aria-label="행 선택" />
          </td>
          <td>${cellEditable(r.customer, "customer", r.id)}</td>
          <td class="cell-muted">${cellEditable(r.majorCopyright, "majorCopyright", r.id, "cell-muted")}</td>
          <td class="cell-muted">${cellEditable(r.pattern, "pattern", r.id, "cell-muted")}</td>
          <td>${cellEditable(r.controlPanel, "controlPanel", r.id)}</td>
          <td>${cellEditable(r.copyrightName, "copyrightName", r.id)}</td>
          <td>${cellEditable(r.aiProduct, "aiProduct", r.id)}</td>
          <td>${cellEditable(r.evidence, "evidence", r.id)}</td>
          <td class="right pct">${cellEditable(r.accuracy, "accuracy", r.id, "pct")}</td>
          <td>${cellEditable(r.type, "type", r.id)}</td>
          <td>${cellEditable(r.aiEval, "aiEval", r.id)}</td>
          <td data-license-cell="${r.id}"></td>
        </tr>
      `).join("");

      bindEvents();
      updateLicenseColumn();
    }

    function bindEvents(){
      // row checkbox
      tbody.querySelectorAll('input[type="checkbox"][data-check]').forEach(cb => {
        cb.addEventListener("change", () => {
          const id = Number(cb.getAttribute("data-check"));
          const row = rows.find(x => x.id === id);
          row.checked = cb.checked;
          render();
        });
      });

      // editable (dblclick -> edit)
      tbody.querySelectorAll('[data-edit="1"]').forEach(div => {
        div.addEventListener("dblclick", () => {
          div.classList.add("editing");
          div.setAttribute("contenteditable", "true");
          div.focus();

          // caret end
          const range = document.createRange();
          range.selectNodeContents(div);
          range.collapse(false);
          const sel = window.getSelection();
          sel.removeAllRanges();
          sel.addRange(range);
        });

        // prevent Enter newline
        div.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            div.blur();
          }
        });

        // save on blur
        div.addEventListener("blur", () => {
          div.classList.remove("editing");
          div.setAttribute("contenteditable", "false");

          const id = Number(div.getAttribute("data-id"));
          const field = div.getAttribute("data-field");
          const row = rows.find(x => x.id === id);

          const newText = (div.textContent || "").trim();
          row[field] = newText;

          // tooltip 갱신
          div.setAttribute("title", newText);

          // 라이선스 비교 갱신(제어판명 수정 가능성)
          updateLicenseColumn();
        });
      });

      checkAll.checked = rows.length > 0 && rows.every(r => r.checked);
    }

    // ====== 라이선스 표시 규칙 ======
    // - 선택 0~1개: 일치 여부 전부 빈 칸
    // - 선택 2개 이상:
    //   - 선택된 항목 중 같은 그룹이 2개 이상인 그룹은 "일치"
    //   - 선택된 항목 중 단독(1개만 선택된) 그룹은 "불일치"
    function updateLicenseColumn(){
      const selected = rows.filter(r => r.checked);
      selectedCountEl.textContent = String(selected.length);

      // clear all
      rows.forEach(r => {
        const cell = tbody.querySelector(`[data-license-cell="${r.id}"]`);
        if (cell) cell.innerHTML = "";
      });

      if (selected.length < 2){
        checkAll.checked = rows.length > 0 && rows.every(r => r.checked);
        return;
      }

      const groupCount = new Map();
      selected.forEach(r => {
        const g = deriveLicenseGroup(r.controlPanel);
        groupCount.set(g, (groupCount.get(g) || 0) + 1);
      });

      selected.forEach(r => {
        const g = deriveLicenseGroup(r.controlPanel);
        const c = groupCount.get(g) || 0;
        const isMatch = c >= 2;

        const cell = tbody.querySelector(`[data-license-cell="${r.id}"]`);
        if (!cell) return;

        cell.innerHTML = isMatch
          ? `<span class="badge match" title="선택 항목 중 동일 그룹이 2개 이상">일치</span>`
          : `<span class="badge mismatch" title="선택 항목 중 해당 그룹이 단독">불일치</span>`;
      });

      checkAll.checked = rows.length > 0 && rows.every(r => r.checked);
    }

    // header checkAll
    checkAll.addEventListener("change", () => {
      const v = checkAll.checked;
      rows.forEach(r => r.checked = v);
      render();
    });

    document.getElementById("btnClear").addEventListener("click", () => {
      rows.forEach(r => r.checked = false);
      render();
    });

    document.getElementById("btnSave").addEventListener("click", () => {
      const payload = rows.map(r => ({
        id: r.id,
        checked: r.checked,
        controlPanel: r.controlPanel,
        licenseGroup: deriveLicenseGroup(r.controlPanel),
      }));
      console.log("SAVE PAYLOAD (sample)", payload);
      alert("작업저장(샘플): 콘솔에 payload를 출력했습니다.");
    });

    // ====== 컬럼 리사이즈: colgroup width를 드래그로 변경 ======
    (function initColumnResize(){
      const table = document.getElementById('tbl');
      const colgroup = document.getElementById('colgroup');

      const minWidth = 70;          // 컬럼 최소 폭
      const keepTableWidth = true;  // true: 다음 컬럼을 같이 줄여 전체 폭 유지 / false: 테이블 폭이 늘어남(가로 스크롤)

      let activeColIndex = null;
      let startX = 0;
      let startW = 0;
      let startNextW = 0;

      function colWidthPx(colEl){
        return colEl.getBoundingClientRect().width;
      }

      function onMove(e){
        if (activeColIndex === null) return;

        const dx = e.clientX - startX;
        const col = colgroup.children[activeColIndex];
        if (!col) return;

        // 기본: 현재 컬럼 폭 변경
        let newW = Math.max(minWidth, startW + dx);

        if (keepTableWidth){
          const next = colgroup.children[activeColIndex + 1];
          if (next){
            let newNextW = Math.max(minWidth, startNextW - dx);

            // next가 minWidth에 걸릴 경우 보정
            const effectiveDx = (startNextW - newNextW);
            newW = Math.max(minWidth, startW + effectiveDx);

            col.style.width = newW + 'px';
            next.style.width = newNextW + 'px';
            return;
          }
        }

        col.style.width = newW + 'px';
      }

      function onUp(){
        if (activeColIndex === null) return;
        document.body.classList.remove('resizing');
        activeColIndex = null;
        window.removeEventListener('mousemove', onMove);
        window.removeEventListener('mouseup', onUp);
      }

      table.querySelectorAll('.col-resizer').forEach(handle => {
        handle.addEventListener('mousedown', (e) => {
          e.preventDefault();

          const idx = Number(handle.getAttribute('data-col'));
          const col = colgroup.children[idx];
          if (!col) return;

          activeColIndex = idx;
          startX = e.clientX;
          startW = colWidthPx(col);

          const next = colgroup.children[idx + 1];
          startNextW = next ? colWidthPx(next) : 0;

          document.body.classList.add('resizing');
          window.addEventListener('mousemove', onMove);
          window.addEventListener('mouseup', onUp);
        });
      });
    })();

    // 최초 렌더
    render();
  </script>

</body></html>
